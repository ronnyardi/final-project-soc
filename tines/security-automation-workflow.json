{
  "schema_version": 4,
  "name": "Security Automation Workflow",
  "description": null,
  "guid": "0076cc5cf1a025b7f32f9dc1f49dda42",
  "exported_at": "2022-05-14T23:37:06Z",
  "agents": [
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Search for IP Address in VirusTotal",
      "disabled": false,
      "guid": "b9aef70da51d0368660c4b884ac49e26",
      "options": {
        "url": "https://www.virustotal.com/api/v3/ip_addresses/<<query_correlated_event.body._source.source.ip>>",
        "method": "get",
        "payload": {},
        "headers": {
          "x-apikey": "<<CREDENTIAL.virustotal>>"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::WebhookAgent",
      "name": "Elastic Security Webhook",
      "disabled": false,
      "guid": "fa89c3f9ab56dcab1d5042b33f9f2c94",
      "options": {
        "path": "8f98bd59f397960b1a71f454673a276c",
        "secret": "f41e9b44bb146ee646219866dca0654d",
        "verbs": "get,post"
      },
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "GeoLocate an IP Address",
      "disabled": false,
      "guid": "d3fe7815cd6b072e7334a4d17089adbf",
      "options": {
        "url": "http://ip-api.com/json/<<query_correlated_event.body._source.source.ip>>",
        "content_type": "json",
        "method": "post",
        "payload": {},
        "headers": {}
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Create Elastic SIEM Case",
      "disabled": false,
      "guid": "b79ffa325958eb5f573c8dfdc1701895",
      "options": {
        "url": "https://<<RESOURCE.kibana_url>>/api/cases",
        "content_type": "json",
        "method": "post",
        "payload": {
          "title": "[Open Case] Tines - <<STORY_RUN_GUID()>>",
          "tags": [],
          "description": "This case was created by [Tines](<<STORY_RUN_LINK()>>) as a result of a following critical alert triggering. It can be found attached to this case. ",
          "connector": {
            "id": "none",
            "name": "none",
            "type": ".none",
            "fields": null
          },
          "owner": "securitySolution",
          "settings": {
            "syncAlerts": true
          }
        },
        "headers": {
          "kbn-xsrf": "true",
          "Authorization": "ApiKey <<CREDENTIAL.elasticsearch>>"
        },
        "disable_ssl_verification": true
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Lookup IP in GreyNoise Community",
      "disabled": false,
      "guid": "6c9552dd681c08bb8bdf394c2b7848fe",
      "options": {
        "url": "https://api.greynoise.io/v3/community/<<query_correlated_event.body._source.source.ip>>",
        "content_type": "json",
        "method": "get",
        "payload": {},
        "headers": {}
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Query Correlated Event",
      "disabled": false,
      "guid": "dcb3e9143d5ed86e8647c422ad4452b5",
      "options": {
        "url": "https://<<RESOURCE.elasticsearch_url>>/<<elastic_security_webhook.body.parent_index>>/_doc/<<elastic_security_webhook.body.parent_id>>",
        "content_type": "json",
        "method": "get",
        "payload": {
          "query": {
            "match_all": {}
          }
        },
        "headers": {
          "kbn-xsrf": "true",
          "Authorization": "ApiKey <<CREDENTIAL.elasticsearch>>"
        },
        "disable_ssl_verification": true
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Is SQL injection?",
      "disabled": false,
      "guid": "c2a0df4a640bef615a642511c6701ccb",
      "options": {
        "rules": [
          {
            "type": "field==value",
            "value": "sqli",
            "path": "<<elastic_security_webhook.body.alert_tag>>"
          }
        ]
      },
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Post Message to Telegram Bot",
      "disabled": false,
      "guid": "3f1dfe4761ef11543d0c05ff09c088f3",
      "options": {
        "url": "https://api.telegram.org/bot<<CREDENTIAL.telegram_bot>>/sendMessage",
        "content_type": "json",
        "method": "post",
        "payload": {
          "chat_id": "<<RESOURCE.telegram_chat_id>>",
          "text": "[Alert]\nAn alert created in Elastic Security detected as <<elastic_security_webhook.body.name>> at <<elastic_security_webhook.body.time>>.\n\nSource IP: <<query_correlated_event.body._source.source.ip>>\nCountry: <<query_correlated_event.body._source.source.geo.country_name>>\n\nPlease consider to check it at https://35.240.140.173:5601/app/security/rules/id/<<elastic_security_webhook.body.alert_id>>.\n(DEMO TA3)"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Is XSS Attack?",
      "disabled": false,
      "guid": "ddcc60ad9864ffdd328ed3b922508bde",
      "options": {
        "rules": [
          {
            "type": "field==value",
            "value": "xss",
            "path": "<<elastic_security_webhook.body.alert_tag>>"
          }
        ]
      },
      "keep_events_for": 0
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Is XSS Reflected?",
      "disabled": false,
      "guid": "94647b324111beee4c81266798a5f486",
      "options": {
        "rules": [
          {
            "type": "in",
            "value": "Reflected",
            "path": "=elastic_security_webhook.body.name"
          }
        ]
      },
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Post Message to Telegram Bot",
      "disabled": false,
      "guid": "68f1d9fa1811385b319713c57eb63495",
      "options": {
        "url": "https://api.telegram.org/bot<<CREDENTIAL.telegram_bot>>/sendMessage",
        "content_type": "json",
        "method": "post",
        "payload": {
          "chat_id": "<<RESOURCE.telegram_chat_id>>",
          "text": "[Alert]\nAn alert created in Elastic Security detected as <<elastic_security_webhook.body.name>> at <<elastic_security_webhook.body.time>>.\n\nSource IP: <<query_correlated_event.body._source.source.ip>>\nCountry: <<query_correlated_event.body._source.source.geo.country_name>>\n\nPlease consider to check it at https://35.240.140.173:5601/app/security/rules/id/<<elastic_security_webhook.body.alert_id>>.\n(DEMO TA3)"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Is Botnet?",
      "disabled": false,
      "guid": "022337670ca6d53b92f67c7a5c7b5be4",
      "options": {
        "rules": [
          {
            "type": "in",
            "value": "ssh",
            "path": "=elastic_security_webhook.body.alert_tag"
          }
        ]
      },
      "keep_events_for": 0
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Malicious?",
      "disabled": false,
      "guid": "74e4d7a50a29c00b2611fbbd50f0ef99",
      "options": {
        "rules": [
          {
            "type": "field==value",
            "value": "malicious",
            "path": "<<lookup_ip_in_greynoise_community.body.classification>>"
          }
        ]
      },
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Block On DigitalOcean Firewall",
      "disabled": false,
      "guid": "468ed7b662b25d90f12e59b0443a5061",
      "options": {
        "url": "https://api.digitalocean.com/v2/firewalls/<<event_transform_action.firewall.id>>",
        "content_type": "json",
        "method": "put",
        "payload": {
          "name": "<<event_transform_action.firewall.name>>",
          "inbound_rules": [
            {
              "protocol": "tcp",
              "ports": "22",
              "sources": {
                "addresses": [
                  "120.188.34.211",
                  "167.205.0.219",
                  "::/0"
                ]
              }
            },
            {
              "protocol": "icmp",
              "ports": "0",
              "sources": {
                "addresses": [
                  "0.0.0.0/0",
                  "::/0"
                ]
              }
            }
          ],
          "outbound_rules": [
            {
              "protocol": "icmp",
              "ports": "0",
              "destinations": {
                "addresses": [
                  "0.0.0.0/0",
                  "::/0"
                ]
              }
            },
            {
              "protocol": "tcp",
              "ports": "0",
              "destinations": {
                "addresses": [
                  "0.0.0.0/0",
                  "::/0"
                ]
              }
            },
            {
              "protocol": "udp",
              "ports": "0",
              "destinations": {
                "addresses": [
                  "0.0.0.0/0",
                  "::/0"
                ]
              }
            }
          ],
          "droplet_ids": [
            299718245
          ]
        },
        "headers": {
          "Authorization": "Bearer <<CREDENTIAL.digitalocean>>"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Add Comment to Case",
      "disabled": false,
      "guid": "7d530694201a3af221c8f489eccc811c",
      "options": {
        "url": "https://<<RESOURCE.kibana_url>>/api/cases/<<create_elastic_siem_case.body.id>>/comments",
        "content_type": "json",
        "method": "post",
        "payload": {
          "type": "user",
          "comment": "`<<query_correlated_event.body._source.source.ip>>` was **<%if block_on_digitalocean_firewall.status = 200%> successfully <%else%> unsuccessfully <%endif%> ** blocked on the firewall after being determined as **<<lookup_ip_in_greynoise_community.body.classification>>** by [Greynoise](https://www.greynoise.io/viz/ip/<<query_correlated_event.body._source.source.ip>>). The response to the request can be found below:\n```\n<<NEAT_JSON(block_on_digitalocean_firewall.body)>>\n```\n\nClick [here](https://cloud.digitalocean.com/networking/firewalls/<<event_transform_action.firewall.id>>) to view this new rule in the DigitalOcean.",
          "owner": "securitySolution"
        },
        "headers": {
          "kbn-xsrf": "true",
          "Authorization": "ApiKey <<CREDENTIAL.elasticsearch>>"
        },
        "disable_ssl_verification": true
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::EmailAgent",
      "name": "Email Action",
      "disabled": false,
      "guid": "7425d9a7887e96394a78691503d59fd6",
      "options": {
        "recipients": [
          "demo-ta3@tutanota.com"
        ],
        "subject": "Case created in Elastic Security",
        "body": "\\<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n\\<html xmlns=\"http://www.w3.org/1999/xhtml\" style=\"font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\n\\<head>\n\\<meta name=\"viewport\" content=\"width=device-width\" />\n\\<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\n\n\\<style type=\"text/css\">\nimg {\nmax-width: 100%;\n}\nbody {\n-webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; width: 100% !important; height: 100%; line-height: 1.6em;\n}\nbody {\nbackground-color: #f6f6f6;\n}\n@media only screen and (max-width: 640px) {\n  body {\n    padding: 0 !important;\n  }\n  h1 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h2 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h3 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h4 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h1 {\n    font-size: 22px !important;\n  }\n  h2 {\n    font-size: 18px !important;\n  }\n  h3 {\n    font-size: 16px !important;\n  }\n  .container {\n    padding: 0 !important; width: 100% !important;\n  }\n  .content {\n    padding: 0 !important;\n  }\n  .content-wrap {\n    padding: 10px !important;\n  }\n  .invoice {\n    width: 100% !important;\n  }\n}\n\\</style>\n\\</head>\n\n\\<body itemscope itemtype=\"http://schema.org/EmailMessage\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; width: 100% !important; height: 100%; line-height: 1.6em; background-color: #f6f6f6; margin: 0;\" bgcolor=\"#f6f6f6\">\n\n\\<table class=\"body-wrap\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; background-color: #f6f6f6; margin: 0;\" bgcolor=\"#f6f6f6\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;\" valign=\"top\">\\</td>\n\t\t\\<td class=\"container\" width=\"600\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; display: block !important; max-width: 600px !important; clear: both !important; margin: 0 auto;\" valign=\"top\">\n\t\t\t\\<div class=\"content\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; max-width: 600px; display: block; margin: 0 auto; padding: 20px;\">\n\t\t\t\t\\<table class=\"main\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; border-radius: 3px; background-color: #fff; margin: 0; border: 1px solid #e9e9e9;\" bgcolor=\"#fff\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"alert alert-warning\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 16px; vertical-align: top; color: #fff; font-weight: 500; text-align: center; border-radius: 3px 3px 0 0; background-color: #FF9F00; margin: 0; padding: 20px;\" align=\"center\" bgcolor=\"#FF9F00\" valign=\"top\">\n\t\t\t\t\t\t\tNew Case Created in Elastic Security.\n\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-wrap\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\\<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\tA new case has been created that requires your attention. Click on the link below to view.\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\\<a href=\"<<APPEND(\"https://\", RESOURCE.kibana_url)>>/app/security/cases/<<create_elastic_siem_case.body.id>>\" class=\"btn-primary\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; color: #FFF; text-decoration: none; line-height: 2em; font-weight: bold; text-align: center; cursor: pointer; display: inline-block; border-radius: 5px; text-transform: capitalize; background-color: #348eda; margin: 0; border-color: #348eda; border-style: solid; border-width: 10px 20px;\">Go to case\\</a>\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\tSent via Tines automation <<STORY_RUN_GUID()>>\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\</table>\\</td>\n\t\t\t\t\t\\</tr>\\</table>\\<div class=\"footer\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; clear: both; color: #999; margin: 0; padding: 20px;\">\n\t\t\t\t\t\\<table width=\"100%\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"aligncenter content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 12px; vertical-align: top; color: #999; text-align: center; margin: 0; padding: 0 0 20px;\" align=\"center\" valign=\"top\">\\<a href=\"<<STORY_RUN_LINK()>>\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 12px; color: #999; text-decoration: underline; margin: 0;\">View\\</a> Tines story run.\\</td>\n\t\t\t\t\t\t\\</tr>\\</table>\\</div>\\</div>\n\t\t\\</td>\n\t\t\\<td style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;\" valign=\"top\">\\</td>\n\t\\</tr>\\</table>\\</body>\n\\</html>"
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::EmailAgent",
      "name": "Email Action",
      "disabled": false,
      "guid": "8c1ea2b1e135c69a757b885aefecbc52",
      "options": {
        "recipients": [
          "demo-ta3@tutanota.com"
        ],
        "subject": "New Case created in Elastic Security",
        "body": "\\<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n\\<html xmlns=\"http://www.w3.org/1999/xhtml\" style=\"font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\n\\<head>\n\\<meta name=\"viewport\" content=\"width=device-width\" />\n\\<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\n\n\\<style type=\"text/css\">\nimg {\nmax-width: 100%;\n}\nbody {\n-webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; width: 100% !important; height: 100%; line-height: 1.6em;\n}\nbody {\nbackground-color: #f6f6f6;\n}\n@media only screen and (max-width: 640px) {\n  body {\n    padding: 0 !important;\n  }\n  h1 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h2 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h3 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h4 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h1 {\n    font-size: 22px !important;\n  }\n  h2 {\n    font-size: 18px !important;\n  }\n  h3 {\n    font-size: 16px !important;\n  }\n  .container {\n    padding: 0 !important; width: 100% !important;\n  }\n  .content {\n    padding: 0 !important;\n  }\n  .content-wrap {\n    padding: 10px !important;\n  }\n  .invoice {\n    width: 100% !important;\n  }\n}\n\\</style>\n\\</head>\n\n\\<body itemscope itemtype=\"http://schema.org/EmailMessage\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; width: 100% !important; height: 100%; line-height: 1.6em; background-color: #f6f6f6; margin: 0;\" bgcolor=\"#f6f6f6\">\n\n\\<table class=\"body-wrap\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; background-color: #f6f6f6; margin: 0;\" bgcolor=\"#f6f6f6\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;\" valign=\"top\">\\</td>\n\t\t\\<td class=\"container\" width=\"600\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; display: block !important; max-width: 600px !important; clear: both !important; margin: 0 auto;\" valign=\"top\">\n\t\t\t\\<div class=\"content\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; max-width: 600px; display: block; margin: 0 auto; padding: 20px;\">\n\t\t\t\t\\<table class=\"main\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; border-radius: 3px; background-color: #fff; margin: 0; border: 1px solid #e9e9e9;\" bgcolor=\"#fff\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"alert alert-warning\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 16px; vertical-align: top; color: #fff; font-weight: 500; text-align: center; border-radius: 3px 3px 0 0; background-color: #FF9F00; margin: 0; padding: 20px;\" align=\"center\" bgcolor=\"#FF9F00\" valign=\"top\">\n\t\t\t\t\t\t\tNew Case Created in Elastic Security.\n\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-wrap\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\\<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\tA new case has been created that requires your attention. Click on the link below to view.\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\\<a href=\"<<APPEND(\"https://\", RESOURCE.kibana_url)>>/app/security/cases/<<create_elastic_siem_case.body.id>>\" class=\"btn-primary\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; color: #FFF; text-decoration: none; line-height: 2em; font-weight: bold; text-align: center; cursor: pointer; display: inline-block; border-radius: 5px; text-transform: capitalize; background-color: #348eda; margin: 0; border-color: #348eda; border-style: solid; border-width: 10px 20px;\">Go to case\\</a>\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\tSent via Tines automation <<STORY_RUN_GUID()>>\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\</table>\\</td>\n\t\t\t\t\t\\</tr>\\</table>\\<div class=\"footer\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; clear: both; color: #999; margin: 0; padding: 20px;\">\n\t\t\t\t\t\\<table width=\"100%\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"aligncenter content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 12px; vertical-align: top; color: #999; text-align: center; margin: 0; padding: 0 0 20px;\" align=\"center\" valign=\"top\">\\<a href=\"<<STORY_RUN_LINK()>>\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 12px; color: #999; text-decoration: underline; margin: 0;\">View\\</a> Tines story run.\\</td>\n\t\t\t\t\t\t\\</tr>\\</table>\\</div>\\</div>\n\t\t\\</td>\n\t\t\\<td style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;\" valign=\"top\">\\</td>\n\t\\</tr>\\</table>\\</body>\n\\</html>"
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::EmailAgent",
      "name": "Email Action",
      "disabled": false,
      "guid": "883dfa3a5981e6bf58ee5182ba3ca077",
      "options": {
        "recipients": [
          "demo-ta3@tutanota.com"
        ],
        "subject": "Case created in Elastic Security",
        "body": "\\<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n\\<html xmlns=\"http://www.w3.org/1999/xhtml\" style=\"font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\n\\<head>\n\\<meta name=\"viewport\" content=\"width=device-width\" />\n\\<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\n\n\\<style type=\"text/css\">\nimg {\nmax-width: 100%;\n}\nbody {\n-webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; width: 100% !important; height: 100%; line-height: 1.6em;\n}\nbody {\nbackground-color: #f6f6f6;\n}\n@media only screen and (max-width: 640px) {\n  body {\n    padding: 0 !important;\n  }\n  h1 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h2 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h3 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h4 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h1 {\n    font-size: 22px !important;\n  }\n  h2 {\n    font-size: 18px !important;\n  }\n  h3 {\n    font-size: 16px !important;\n  }\n  .container {\n    padding: 0 !important; width: 100% !important;\n  }\n  .content {\n    padding: 0 !important;\n  }\n  .content-wrap {\n    padding: 10px !important;\n  }\n  .invoice {\n    width: 100% !important;\n  }\n}\n\\</style>\n\\</head>\n\n\\<body itemscope itemtype=\"http://schema.org/EmailMessage\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; width: 100% !important; height: 100%; line-height: 1.6em; background-color: #f6f6f6; margin: 0;\" bgcolor=\"#f6f6f6\">\n\n\\<table class=\"body-wrap\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; background-color: #f6f6f6; margin: 0;\" bgcolor=\"#f6f6f6\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;\" valign=\"top\">\\</td>\n\t\t\\<td class=\"container\" width=\"600\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; display: block !important; max-width: 600px !important; clear: both !important; margin: 0 auto;\" valign=\"top\">\n\t\t\t\\<div class=\"content\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; max-width: 600px; display: block; margin: 0 auto; padding: 20px;\">\n\t\t\t\t\\<table class=\"main\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; border-radius: 3px; background-color: #fff; margin: 0; border: 1px solid #e9e9e9;\" bgcolor=\"#fff\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"alert alert-warning\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 16px; vertical-align: top; color: #fff; font-weight: 500; text-align: center; border-radius: 3px 3px 0 0; background-color: #FF9F00; margin: 0; padding: 20px;\" align=\"center\" bgcolor=\"#FF9F00\" valign=\"top\">\n\t\t\t\t\t\t\tNew Case Created in Elastic Security.\n\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-wrap\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\\<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\tA new case has been created that requires your attention. Click on the link below to view.\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\\<a href=\"<<APPEND(\"https://\", RESOURCE.kibana_url)>>/app/security/cases/<<create_elastic_siem_case.body.id>>\" class=\"btn-primary\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; color: #FFF; text-decoration: none; line-height: 2em; font-weight: bold; text-align: center; cursor: pointer; display: inline-block; border-radius: 5px; text-transform: capitalize; background-color: #348eda; margin: 0; border-color: #348eda; border-style: solid; border-width: 10px 20px;\">Go to case\\</a>\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\tSent via Tines automation <<STORY_RUN_GUID()>>\n\t\t\t\t\t\t\t\t\t\\</td>\n\t\t\t\t\t\t\t\t\\</tr>\\</table>\\</td>\n\t\t\t\t\t\\</tr>\\</table>\\<div class=\"footer\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; clear: both; color: #999; margin: 0; padding: 20px;\">\n\t\t\t\t\t\\<table width=\"100%\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\\<td class=\"aligncenter content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 12px; vertical-align: top; color: #999; text-align: center; margin: 0; padding: 0 0 20px;\" align=\"center\" valign=\"top\">\\<a href=\"<<STORY_RUN_LINK()>>\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 12px; color: #999; text-decoration: underline; margin: 0;\">View\\</a> Tines story run.\\</td>\n\t\t\t\t\t\t\\</tr>\\</table>\\</div>\\</div>\n\t\t\\</td>\n\t\t\\<td style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;\" valign=\"top\">\\</td>\n\t\\</tr>\\</table>\\</body>\n\\</html>"
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Is XSS DOM?",
      "disabled": false,
      "guid": "f469ce4d9b7ab4e5e7ea9a999d561160",
      "options": {
        "rules": [
          {
            "type": "in",
            "value": "DOM",
            "path": "=elastic_security_webhook.body.name"
          }
        ]
      },
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Get DigitalOcean Firewall Details",
      "disabled": false,
      "guid": "86f3ad866e580f78de98535194d4d355",
      "options": {
        "url": "https://api.digitalocean.com/v2/firewalls",
        "content_type": "json",
        "method": "get",
        "payload": {},
        "headers": {
          "Authorization": "Bearer <<CREDENTIAL.digitalocean>>",
          "Content-Type": "application/json"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::EventTransformationAgent",
      "name": "Event Transform Action",
      "disabled": false,
      "guid": "ccedc2879e41df21d81167bf553fe96d",
      "options": {
        "mode": "explode",
        "path": "=get_digitalocean_firewall_details.body.firewalls",
        "to": "firewall"
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::EventTransformationAgent",
      "name": "Keep Blocking for 15 minutes",
      "disabled": false,
      "guid": "199451f95dab416d831edd0a2ac26218",
      "options": {
        "mode": "delay",
        "seconds": "900"
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Restore DigitalOcean Firewall",
      "disabled": false,
      "guid": "bfef94d6ebfbb88a879c3aba198ea553",
      "options": {
        "url": "https://api.digitalocean.com/v2/firewalls/<<event_transform_action.firewall.id>>",
        "content_type": "json",
        "method": "put",
        "payload": {
          "name": "<<event_transform_action.firewall.name>>",
          "inbound_rules": [
            {
              "protocol": "tcp",
              "ports": "22",
              "sources": {
                "addresses": [
                  "120.188.34.211",
                  "167.205.0.219",
                  "::/0",
                  "0.0.0.0/0"
                ]
              }
            },
            {
              "protocol": "icmp",
              "ports": "0",
              "sources": {
                "addresses": [
                  "0.0.0.0/0",
                  "::/0"
                ]
              }
            }
          ],
          "outbound_rules": [
            {
              "protocol": "icmp",
              "ports": "0",
              "destinations": {
                "addresses": [
                  "0.0.0.0/0",
                  "::/0"
                ]
              }
            },
            {
              "protocol": "tcp",
              "ports": "0",
              "destinations": {
                "addresses": [
                  "0.0.0.0/0",
                  "::/0"
                ]
              }
            },
            {
              "protocol": "udp",
              "ports": "0",
              "destinations": {
                "addresses": [
                  "0.0.0.0/0",
                  "::/0"
                ]
              }
            }
          ],
          "droplet_ids": [
            299718245
          ]
        },
        "headers": {
          "Authorization": "Bearer <<CREDENTIAL.digitalocean>>"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::WebhookAgent",
      "name": "Form Webhook",
      "disabled": false,
      "guid": "189194ebd24e2c45b45a8793855e0c1f",
      "options": {
        "path": "16cc83b51d5d189e55bac29e2c2540a7",
        "secret": "19713a737018e832fe677547054b1161",
        "verbs": "get,post"
      },
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Search for IP Address in VirusTotal",
      "disabled": false,
      "guid": "34efb03777c561d430ceacb9c896ec25",
      "options": {
        "url": "https://www.virustotal.com/api/v3/<<query_correlated_event.body._source.source.ip>>",
        "method": "get",
        "payload": {},
        "headers": {
          "x-apikey": "<<CREDENTIAL.virustotal>>"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::EmailAgent",
      "name": "Email Action",
      "disabled": false,
      "guid": "e2d0add2892ce68967c78d58ea87a118",
      "options": {
        "recipients": [
          "demo-ta3@tutanota.com"
        ],
        "subject": "New Case created in Elastic Security",
        "body": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" style=\"font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\">\n<head>\n<meta name=\"viewport\" content=\"width=device-width\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\n\n<style type=\"text/css\">\nimg {\nmax-width: 100%;\n}\nbody {\n-webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; width: 100% !important; height: 100%; line-height: 1.6em;\n}\nbody {\nbackground-color: #f6f6f6;\n}\n@media only screen and (max-width: 640px) {\n  body {\n    padding: 0 !important;\n  }\n  h1 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h2 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h3 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h4 {\n    font-weight: 800 !important; margin: 20px 0 5px !important;\n  }\n  h1 {\n    font-size: 22px !important;\n  }\n  h2 {\n    font-size: 18px !important;\n  }\n  h3 {\n    font-size: 16px !important;\n  }\n  .container {\n    padding: 0 !important; width: 100% !important;\n  }\n  .content {\n    padding: 0 !important;\n  }\n  .content-wrap {\n    padding: 10px !important;\n  }\n  .invoice {\n    width: 100% !important;\n  }\n}\n</style>\n</head>\n\n<body itemscope itemtype=\"http://schema.org/EmailMessage\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; width: 100% !important; height: 100%; line-height: 1.6em; background-color: #f6f6f6; margin: 0;\" bgcolor=\"#f6f6f6\">\n\n<table class=\"body-wrap\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; background-color: #f6f6f6; margin: 0;\" bgcolor=\"#f6f6f6\"><tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><td style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;\" valign=\"top\"></td>\n\t\t<td class=\"container\" width=\"600\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; display: block !important; max-width: 600px !important; clear: both !important; margin: 0 auto;\" valign=\"top\">\n\t\t\t<div class=\"content\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; max-width: 600px; display: block; margin: 0 auto; padding: 20px;\">\n\t\t\t\t<table class=\"main\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; border-radius: 3px; background-color: #fff; margin: 0; border: 1px solid #e9e9e9;\" bgcolor=\"#fff\"><tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><td class=\"alert alert-warning\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 16px; vertical-align: top; color: #fff; font-weight: 500; text-align: center; border-radius: 3px 3px 0 0; background-color: #FF9F00; margin: 0; padding: 20px;\" align=\"center\" bgcolor=\"#FF9F00\" valign=\"top\">\n\t\t\t\t\t\t\tNew Case Created in Elastic Security.\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr><tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><td class=\"content-wrap\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr><tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\tA new case has been created that requires your attention. Click on the link below to view.\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr><tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\t<a href=\"<<APPEND(\"https://\", RESOURCE.kibana_url)>>/app/security/cases/<<create_elastic_siem_case.body.id>>\" class=\"btn-primary\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; color: #FFF; text-decoration: none; line-height: 2em; font-weight: bold; text-align: center; cursor: pointer; display: inline-block; border-radius: 5px; text-transform: capitalize; background-color: #348eda; margin: 0; border-color: #348eda; border-style: solid; border-width: 10px 20px;\">Go to case</a>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr><tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><td class=\"content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;\" valign=\"top\">\n\t\t\t\t\t\t\t\t\t\tSent via Tines automation <<STORY_RUN_GUID()>>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr></table></td>\n\t\t\t\t\t</tr></table><div class=\"footer\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; clear: both; color: #999; margin: 0; padding: 20px;\">\n\t\t\t\t\t<table width=\"100%\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><tr style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;\"><td class=\"aligncenter content-block\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 12px; vertical-align: top; color: #999; text-align: center; margin: 0; padding: 0 0 20px;\" align=\"center\" valign=\"top\"><a href=\"<<STORY_RUN_LINK()>>\" style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 12px; color: #999; text-decoration: underline; margin: 0;\">View</a> Tines story run.</td>\n\t\t\t\t\t\t</tr></table></div></div>\n\t\t</td>\n\t\t<td style=\"font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;\" valign=\"top\"></td>\n\t</tr></table></body>\n</html>"
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::TriggerAgent",
      "name": "Trigger Action",
      "disabled": false,
      "guid": "1001d87e0f37c85d7a4a3ed2a59f4d53",
      "options": {
        "rules": [
          {
            "type": "regex",
            "value": ".*",
            "path": "<<form_webhook.body.url_you_want_to_analyze>>"
          }
        ]
      },
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Search for IP Address in VirusTotal",
      "disabled": false,
      "guid": "4de1a2aeb6f210d36f8802a797348e4d",
      "options": {
        "url": "https://www.virustotal.com/api/v3/<<query_correlated_event.body._source.source.ip>>",
        "method": "get",
        "payload": {},
        "headers": {
          "x-apikey": "<<CREDENTIAL.virustotal>>"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Search for URL in VirusTotal",
      "disabled": false,
      "guid": "9e4702aece87e13236d0cd6a95df7f5f",
      "options": {
        "url": "https://www.virustotal.com/api/v3/<<query_correlated_event.body._source.source.ip>>",
        "method": "get",
        "payload": {},
        "headers": {
          "x-apikey": "<<CREDENTIAL.virustotal>>"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Add Comment to Case",
      "disabled": false,
      "guid": "575f7ccda14a3dee456eee4dd87f7e03",
      "options": {
        "url": "https://<<RESOURCE.kibana_url>>/api/cases/<<create_elastic_siem_case.body.id>>/comments",
        "content_type": "json",
        "method": "post",
        "payload": {
          "type": "user",
          "comment": "`<<for_each_ip.individual_ip>>` was found present **<<query_elasticsearch_for_ip_hits.body.hits.total.value>>** times within our last 90 days of logs. \n\nThere were also **<<query_elasticsearch_for_ip_detection_hits.body.hits.total.value>>** alerts triggered for the same IP.\n\nPlease view the automatically created [timeline](<<APPEND(\"https://\",RESOURCE.kibana_url)>>/app/security/timelines?timeline=(id:%27<<create_timeline_with_ip_search.body.data.persistTimeline.timeline.savedObjectId>>%27,isOpen:!t)) below to find out more.\n",
          "owner": "securitySolution"
        },
        "headers": {
          "kbn-xsrf": "true",
          "Authorization": "ApiKey <<CREDENTIAL.elasticsearch>>"
        },
        "disable_ssl_verification": true
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Create Timeline With IP Search",
      "disabled": false,
      "guid": "41fc12032c2d2cfece77dcee7dd25399",
      "options": {
        "url": "https://<<RESOURCE.kibana_url>>/api/timeline",
        "content_type": "json",
        "method": "post",
        "payload": {
          "timeline": {
            "columns": [
              {
                "id": "@timestamp"
              },
              {
                "id": "user.name"
              },
              {
                "id": "source.ip"
              },
              {
                "id": "destination.ip"
              },
              {
                "id": "host.name"
              },
              {
                "id": "event.dataset"
              }
            ],
            "dataProviders": [
              {
                "name": "destination.ip",
                "enabled": true,
                "excluded": false,
                "id": "timeline-2-914beb92-86ab-471c-a00b-25b7e20c2d11",
                "queryMatch": {
                  "field": "destination.ip",
                  "value": "<<query_correlated_event.body._source.source.ip>>",
                  "operator": ":"
                },
                "and": []
              },
              {
                "name": "source.ip",
                "enabled": true,
                "excluded": false,
                "id": "timeline-1-914beb92-86ab-471c-a00b-25b7e20c2d11",
                "queryMatch": {
                  "field": "source.ip",
                  "value": "<<query_correlated_event.body._source.source.ip>>",
                  "operator": ":"
                },
                "and": []
              }
            ],
            "dateRange": {
              "start": "<<DATE(\"now\", \"%s\") |> MINUS(%, 7776000) |> DATE(%, \"%Y-%m-%dT%H:%M:%S.000Z\")>>",
              "end": "<<DATE(\"now\", \"%s\") |> DATE(%, \"%Y-%m-%dT%H:%M:%S.000Z\")>>"
            },
            "description": "This timeline was automatically created via tines.",
            "title": "Created with Tines - <<STORY_RUN_GUID()>>"
          }
        },
        "headers": {
          "kbn-xsrf": "kibana",
          "Authorization": "ApiKey <<CREDENTIAL.elasticsearch>>"
        },
        "disable_ssl_verification": true
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Query Elasticsearch for IP Detection Hits",
      "disabled": false,
      "guid": "8e68022fb8d9953332cf7123f1a8d2c7",
      "options": {
        "url": "https://<<RESOURCE.elasticsearch_url>>/.siem-signals-default*/_search",
        "content_type": "json",
        "method": "post",
        "payload": {
          "aggs": {},
          "size": 0,
          "_source": {
            "excludes": []
          },
          "query": {
            "bool": {
              "must": [],
              "filter": [
                {
                  "bool": {
                    "should": [
                      {
                        "bool": {
                          "should": [
                            {
                              "match_phrase": {
                                "source.ip": "<<query_correlated_event.body._source.source.ip>>"
                              }
                            }
                          ],
                          "minimum_should_match": 1
                        }
                      },
                      {
                        "bool": {
                          "should": [
                            {
                              "match_phrase": {
                                "destination.ip": "<<query_correlated_event.body._source.source.ip>>"
                              }
                            }
                          ],
                          "minimum_should_match": 1
                        }
                      }
                    ],
                    "minimum_should_match": 1
                  }
                },
                {
                  "range": {
                    "@timestamp": {
                      "gte": "now-90d"
                    }
                  }
                }
              ],
              "should": [],
              "must_not": []
            }
          }
        },
        "disable_ssl_verification": true,
        "headers": {
          "Authorization": "ApiKey <<CREDENTIAL.elasticsearch>>"
        }
      },
      "schedule": null,
      "keep_events_for": 0
    },
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Query Elasticsearch for IP Hits",
      "disabled": false,
      "guid": "2ade3e1c2d2fd8cccf4d2b6b424270e3",
      "options": {
        "url": "https://<<RESOURCE.elasticsearch_url>>/logs-*,filebeat-*,packetbeat-*/_search",
        "content_type": "json",
        "method": "post",
        "payload": {
          "aggs": {},
          "size": 0,
          "_source": {
            "excludes": []
          },
          "query": {
            "bool": {
              "must": [],
              "filter": [
                {
                  "bool": {
                    "should": [
                      {
                        "bool": {
                          "should": [
                            {
                              "match_phrase": {
                                "source.ip": "<<query_correlated_event.body._source.source.ip>>"
                              }
                            }
                          ],
                          "minimum_should_match": 1
                        }
                      },
                      {
                        "bool": {
                          "should": [
                            {
                              "match_phrase": {
                                "destination.ip": "<<query_correlated_event.body._source.source.ip>>"
                              }
                            }
                          ],
                          "minimum_should_match": 1
                        }
                      }
                    ],
                    "minimum_should_match": 1
                  }
                },
                {
                  "range": {
                    "@timestamp": {
                      "gte": "now-90d"
                    }
                  }
                }
              ],
              "should": [],
              "must_not": []
            }
          }
        },
        "headers": {
          "Authorization": "ApiKey <<CREDENTIAL.elasticsearch>>"
        },
        "disable_ssl_verification": true
      },
      "schedule": null,
      "keep_events_for": 0
    }
  ],
  "diagram_notes": [],
  "links": [
    {
      "source": 0,
      "receiver": 12
    },
    {
      "source": 1,
      "receiver": 5
    },
    {
      "source": 2,
      "receiver": 4
    },
    {
      "source": 2,
      "receiver": 0
    },
    {
      "source": 3,
      "receiver": 2
    },
    {
      "source": 4,
      "receiver": 12
    },
    {
      "source": 5,
      "receiver": 11
    },
    {
      "source": 5,
      "receiver": 8
    },
    {
      "source": 5,
      "receiver": 6
    },
    {
      "source": 6,
      "receiver": 7
    },
    {
      "source": 7,
      "receiver": 16
    },
    {
      "source": 8,
      "receiver": 18
    },
    {
      "source": 8,
      "receiver": 9
    },
    {
      "source": 9,
      "receiver": 10
    },
    {
      "source": 10,
      "receiver": 17
    },
    {
      "source": 11,
      "receiver": 3
    },
    {
      "source": 12,
      "receiver": 32
    },
    {
      "source": 12,
      "receiver": 19
    },
    {
      "source": 13,
      "receiver": 14
    },
    {
      "source": 13,
      "receiver": 21
    },
    {
      "source": 14,
      "receiver": 15
    },
    {
      "source": 18,
      "receiver": 10
    },
    {
      "source": 19,
      "receiver": 20
    },
    {
      "source": 20,
      "receiver": 13
    },
    {
      "source": 21,
      "receiver": 22
    },
    {
      "source": 23,
      "receiver": 26
    },
    {
      "source": 24,
      "receiver": 25
    },
    {
      "source": 26,
      "receiver": 28
    },
    {
      "source": 26,
      "receiver": 24
    },
    {
      "source": 26,
      "receiver": 27
    },
    {
      "source": 27,
      "receiver": 25
    },
    {
      "source": 28,
      "receiver": 25
    },
    {
      "source": 30,
      "receiver": 29
    },
    {
      "source": 31,
      "receiver": 30
    },
    {
      "source": 32,
      "receiver": 31
    }
  ],
  "diagram_layout": "{\"b9aef70da51d0368660c4b884ac49e26\":[1380,255],\"fa89c3f9ab56dcab1d5042b33f9f2c94\":[1725,-345],\"d3fe7815cd6b072e7334a4d17089adbf\":[1380,150],\"b79ffa325958eb5f573c8dfdc1701895\":[1380,45],\"6c9552dd681c08bb8bdf394c2b7848fe\":[1110,255],\"dcb3e9143d5ed86e8647c422ad4452b5\":[1725,-225],\"c2a0df4a640bef615a642511c6701ccb\":[1725,-90],\"3f1dfe4761ef11543d0c05ff09c088f3\":[1725,15],\"ddcc60ad9864ffdd328ed3b922508bde\":[2085,-90],\"94647b324111beee4c81266798a5f486\":[2265,15],\"68f1d9fa1811385b319713c57eb63495\":[2085,120],\"022337670ca6d53b92f67c7a5c7b5be4\":[1380,-90],\"74e4d7a50a29c00b2611fbbd50f0ef99\":[1290,390],\"468ed7b662b25d90f12e59b0443a5061\":[1020,705],\"7d530694201a3af221c8f489eccc811c\":[1050,825],\"7425d9a7887e96394a78691503d59fd6\":[1080,930],\"8c1ea2b1e135c69a757b885aefecbc52\":[1725,120],\"883dfa3a5981e6bf58ee5182ba3ca077\":[2085,225],\"f469ce4d9b7ab4e5e7ea9a999d561160\":[2085,15],\"86f3ad866e580f78de98535194d4d355\":[1020,510],\"ccedc2879e41df21d81167bf553fe96d\":[1020,615],\"199451f95dab416d831edd0a2ac26218\":[780,825],\"bfef94d6ebfbb88a879c3aba198ea553\":[780,915],\"189194ebd24e2c45b45a8793855e0c1f\":[1995,495],\"34efb03777c561d430ceacb9c896ec25\":[2250,705],\"e2d0add2892ce68967c78d58ea87a118\":[1995,840],\"1001d87e0f37c85d7a4a3ed2a59f4d53\":[1995,585],\"4de1a2aeb6f210d36f8802a797348e4d\":[1995,705],\"9e4702aece87e13236d0cd6a95df7f5f\":[1740,705],\"575f7ccda14a3dee456eee4dd87f7e03\":[1290,825],\"41fc12032c2d2cfece77dcee7dd25399\":[1290,720],\"8e68022fb8d9953332cf7123f1a8d2c7\":[1290,615],\"2ade3e1c2d2fd8cccf4d2b6b424270e3\":[1290,510]}",
  "send_to_story_enabled": false,
  "entry_agent_guid": null,
  "exit_agent_guids": [],
  "exit_agent_guid": null,
  "send_to_stories": [],
  "form": {
    "name": "Security Automation Workflow Form",
    "description": "This form can used for doing analysis about URL, IP address, or Checksum (SHA256, etc) about suspicious files/executable.\n\n(Demo TA3)",
    "fields": [
      {
        "name": "Checksum You Want to Analyze?",
        "description": "",
        "required": false,
        "type": "SHORT_TEXT",
        "multi_select": false,
        "options": [
          "Option 1",
          "Option 2"
        ],
        "ranking": 1879048192,
        "max_characters": null
      },
      {
        "name": "IP Address You Want to Analyze?",
        "description": "",
        "required": false,
        "type": "SHORT_TEXT",
        "multi_select": false,
        "options": [
          "Option 1",
          "Option 2"
        ],
        "ranking": 1610612736,
        "max_characters": null
      },
      {
        "name": "URL You Want to Analyze?",
        "description": "",
        "required": false,
        "type": "URL",
        "multi_select": false,
        "options": [
          "Option 1",
          "Option 2"
        ],
        "ranking": 1073741824,
        "max_characters": null
      },
      {
        "name": "Your email",
        "description": "",
        "required": true,
        "type": "EMAIL",
        "multi_select": false,
        "options": [
          "Option 1",
          "Option 2"
        ],
        "ranking": 0,
        "max_characters": null
      }
    ],
    "visibility": "world",
    "agent_guid": "189194ebd24e2c45b45a8793855e0c1f",
    "success_message": "Thank you for your submission. Please check in your inbox for results."
  }
}